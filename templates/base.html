{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="display" content="standalone">
  <meta name="orientation" content="portrait">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="apple-mobile-web-app-title" content="CrediTrade">
  <meta name="application-name" content="CrediTrade">  
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#1a73e8">
  <meta name="keywords" content="CrediTrade, credits, trading, platform, trade credits, credit trading platform, buying credits, selling credits, credit marketplace, credit exchange, asset-backed trading, receivables trading, invoice trading, trade finance, credit risk management, working capital solutions, liquidity management, financial instruments trading, debt trading, how to trade credits online, best platform for credit trading, secure credit trading marketplace, benefits of trading credits, risks of credit trading, trading credits for small businesses, increase working capital through credit trading, manage credit risk with CrediTrade, find buyers for trade credits, sell receivables on CrediTrade, how to value trade credits, online credit trading for [your target industry], alternative finance solutions, business finance, financial services, investment platform, asset management, supply chain finance, B2B marketplace, financial technology (FinTech), digital finance, online trading, alternative investments, credit card rewards, earn rewards with credit card, cashback credit card, credit card points, credit card benefits, rewards platform, maximize credit card rewards, best rewards credit cards, credit card offers, credit card incentives, earn money with credit cards, credit card loyalty programs, credit card affiliate programs, credit card rewards system">
  <meta name="description" content="Trade credits securely with CrediTrade! Buy, sell, and manage your trade credits efficiently. Discover the best platform for credit exchange and finance solutions.">
  <meta name="author" content="Aman Singh">

  <link rel="manifest" href="{% static 'manifest.json' %}">
  <link rel="icon" href="{% static 'images/ddfavicon.png' %}" type="image/x-icon">
  <title>{% block title %}{% endblock %}</title>

  <!-- CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/3.5.0/remixicon.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="{% static 'css/styles.css' %}">

  <style>
    .pull-refresh {
      position: fixed;
      top: -80px;
      left: 0;
      width: 100%;
      height: 80px;
      background: #1a73e8;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: transform 0.3s ease;
      z-index: 999;
    }

    .pull-refresh.active {
      transform: translateY(80px);
    }

    .spinner {
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top: 4px solid #fff;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>

<body>
  {% include "core/header.html" %}

  <div id="pull-to-refresh" class="pull-refresh">
    <div class="spinner"></div>
  </div>

  <main class="main">
    {% block content %}{% endblock %}
  </main>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
  <script src="{% static 'js/scripts.js' %}"></script>

  <script>
    $(document).ready(() => {
      toastr.options = {
        positionClass: "toast-bottom-center",
        timeOut: 2000
      };

      {% if messages %}
        {% for message in messages %}
          toastr.{{ message.tags }}('{{ message }}');
        {% endfor %}
      {% endif %}

      $('#search-input').on('input', function() {
        const searchTerm = $(this).val().toLowerCase();
        $('#search-results tr').each(function() {
          const name = $(this).find('.search-name').text().toLowerCase();
          const model = $(this).find('.search-model').text().toLowerCase();
          const pin = $(this).find('.search-pin').text().toLowerCase();
          if (name.indexOf(searchTerm) === -1 && model.indexOf(searchTerm) === -1 && pin.indexOf(searchTerm) === -1) {
            $(this).hide();
          } else {
            $(this).show();
          }
        });
      });

      const navigatePage = (page) => {
        const url = `${window.location.pathname}?page=${page}`;
        $.ajax({
          url: url,
          type: 'GET',
          success: (data) => {
            $('#search-results').html($(data).find('#search-results').html());
            $('#pagination-container').html($(data).find('#pagination-container').html());
          },
          error: (xhr) => {
            console.error(xhr.responseText);
          }
        });
      };
    });

    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/static/serviceworker.js')
          .then(reg => {
            reg.update();
            setInterval(() => reg.update(), 24 * 60 * 60 * 1000);
            navigator.serviceWorker.addEventListener('controllerchange', () => {
              window.location.reload();
            });
          })
          .catch(err => console.error('Service Worker registration failed:', err));

        navigator.serviceWorker.addEventListener('message', event => {
          if (event.data && event.data.type === 'UPDATE_AVAILABLE') {
            window.location.reload();
          }
        });
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      const isPWA = () => window.matchMedia('(display-mode: standalone)').matches || navigator.standalone;
      if (!isPWA()) return;

      const refreshContainer = document.getElementById('pull-to-refresh');
      let startY = 0, isRefreshing = false;

      const handleTouchStart = (e) => { if (window.scrollY === 0) startY = e.touches[0].pageY; };
      const handleTouchMove = (e) => { if (!isRefreshing && e.touches[0].pageY - startY > 60) refreshContainer.classList.add('active'); };
      const handleTouchEnd = () => {
        if (refreshContainer.classList.contains('active') && !isRefreshing) {
          isRefreshing = true;
          setTimeout(() => {
            window.location.reload();
            refreshContainer.classList.remove('active');
            isRefreshing = false;
          }, 1000);
        }
      };

      window.addEventListener('touchstart', handleTouchStart);
      window.addEventListener('touchmove', handleTouchMove);
      window.addEventListener('touchend', handleTouchEnd);
    });
  </script>  
</body>
</html>
